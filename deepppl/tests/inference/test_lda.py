
from .harness import MCMCTest
import numpy as np
from pprint import pprint
import pytest

@pytest.mark.xfail(reason="Tensor indexed by another tensor")
def test_lda():
    data = {}
    data['K'] = 2
    data['V'] = 5
    data['M'] = 25
    data['N'] = 262
    data['w'] = [4, 3, 5, 4, 3, 3, 3, 3, 3, 4, 5, 3, 4, 4, 5,
                 3, 4, 4, 4, 3, 5, 4, 5, 2, 3, 3, 1, 5, 5, 1, 4,
                 3, 1, 2, 5, 4, 4, 3, 5, 4, 2, 4, 5, 3, 4, 1, 4,
                 4, 3, 2, 1, 2, 1, 2, 2, 2, 1, 2, 2, 3, 1, 2, 2,
                 4, 4, 5, 4, 5, 5, 4, 3, 5, 4, 4, 4, 2, 2, 1, 1,
                 2, 1, 3, 1, 2, 1, 1, 1, 3, 2, 3, 3, 5, 4, 5, 4,
                 3, 5, 4, 2, 2, 2, 1, 3, 2, 1, 3, 1, 3, 1, 1, 2,
                 1, 2, 2, 4, 4, 4, 5, 5, 4, 4, 5, 4, 3, 3, 3, 1,
                 3, 3, 4, 2, 1, 3, 4, 4, 5, 4, 4, 4, 3, 4, 3, 4,
                 5, 1, 2, 1, 3, 2, 1, 1, 2, 3, 3, 3, 3, 4, 1, 4,
                 4, 4, 4, 3, 4, 4, 1, 2, 2, 3, 3, 1, 1, 4, 1, 3,
                 1, 5, 3, 2, 2, 1, 1, 2, 3, 3, 4, 4, 5, 3, 4, 3,
                 1, 5, 5, 5, 3, 3, 4, 5, 3, 3, 3, 2, 3, 1, 3, 3,
                 1, 3, 1, 5, 5, 5, 2, 2, 3, 3, 3, 1, 1, 5, 5, 5,
                 3, 1, 5, 4, 1, 3, 3, 3, 3, 4, 2, 5, 1, 3, 5, 2,
                 5, 5, 2, 1, 3, 3, 5, 3, 5, 3, 3, 5, 1, 2, 2, 1,
                 1, 2, 1, 2, 3, 1, 1]
    
    data['doc'] = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2,
                   2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
                   3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4,
                   4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                   6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 8, 8, 8, 8,
                   8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9,
                   9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                   10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 12,
                   12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                   14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15,
                   15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                   16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17,
                   17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19,
                   19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20,
                   20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
                   22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23,
                   23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24,
                   24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                   25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25]
                   
    data['a'] = [0.5, 0.5]
    data['b'] = [0.2, 0.2, 0.2, 0.2, 0.2]
     
    t_lda = MCMCTest(
        name='lda',
        model_file='deepppl/tests/good/lda.stan',
        data=data,
    )

    return t_lda.run()
    
if __name__ == "__main__":
    pprint(test_lda())